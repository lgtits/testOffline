import{r as P}from"./__vite-browser-external.afb582f8.js";var Xt={},Ge={};Ge.byteLength=Er;Ge.toByteArray=br;Ge.fromByteArray=Br;var K=[],q=[],xr=typeof Uint8Array<"u"?Uint8Array:Array,et="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var he=0,wr=et.length;he<wr;++he)K[he]=et[he],q[et.charCodeAt(he)]=he;q["-".charCodeAt(0)]=62;q["_".charCodeAt(0)]=63;function Kt(n){var r=n.length;if(r%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var i=n.indexOf("=");i===-1&&(i=r);var o=i===r?0:4-i%4;return[i,o]}function Er(n){var r=Kt(n),i=r[0],o=r[1];return(i+o)*3/4-o}function Sr(n,r,i){return(r+i)*3/4-i}function br(n){var r,i=Kt(n),o=i[0],f=i[1],l=new xr(Sr(n,o,f)),c=0,u=f>0?o-4:o,_;for(_=0;_<u;_+=4)r=q[n.charCodeAt(_)]<<18|q[n.charCodeAt(_+1)]<<12|q[n.charCodeAt(_+2)]<<6|q[n.charCodeAt(_+3)],l[c++]=r>>16&255,l[c++]=r>>8&255,l[c++]=r&255;return f===2&&(r=q[n.charCodeAt(_)]<<2|q[n.charCodeAt(_+1)]>>4,l[c++]=r&255),f===1&&(r=q[n.charCodeAt(_)]<<10|q[n.charCodeAt(_+1)]<<4|q[n.charCodeAt(_+2)]>>2,l[c++]=r>>8&255,l[c++]=r&255),l}function kr(n){return K[n>>18&63]+K[n>>12&63]+K[n>>6&63]+K[n&63]}function Tr(n,r,i){for(var o,f=[],l=r;l<i;l+=3)o=(n[l]<<16&16711680)+(n[l+1]<<8&65280)+(n[l+2]&255),f.push(kr(o));return f.join("")}function Br(n){for(var r,i=n.length,o=i%3,f=[],l=16383,c=0,u=i-o;c<u;c+=l)f.push(Tr(n,c,c+l>u?u:c+l));return o===1?(r=n[i-1],f.push(K[r>>2]+K[r<<4&63]+"==")):o===2&&(r=(n[i-2]<<8)+n[i-1],f.push(K[r>>10]+K[r>>4&63]+K[r<<2&63]+"=")),f.join("")}var dt={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */dt.read=function(n,r,i,o,f){var l,c,u=f*8-o-1,_=(1<<u)-1,m=_>>1,v=-7,y=i?f-1:0,b=i?-1:1,g=n[r+y];for(y+=b,l=g&(1<<-v)-1,g>>=-v,v+=u;v>0;l=l*256+n[r+y],y+=b,v-=8);for(c=l&(1<<-v)-1,l>>=-v,v+=o;v>0;c=c*256+n[r+y],y+=b,v-=8);if(l===0)l=1-m;else{if(l===_)return c?NaN:(g?-1:1)*(1/0);c=c+Math.pow(2,o),l=l-m}return(g?-1:1)*c*Math.pow(2,l-o)};dt.write=function(n,r,i,o,f,l){var c,u,_,m=l*8-f-1,v=(1<<m)-1,y=v>>1,b=f===23?Math.pow(2,-24)-Math.pow(2,-77):0,g=o?0:l-1,k=o?1:-1,x=r<0||r===0&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(u=isNaN(r)?1:0,c=v):(c=Math.floor(Math.log(r)/Math.LN2),r*(_=Math.pow(2,-c))<1&&(c--,_*=2),c+y>=1?r+=b/_:r+=b*Math.pow(2,1-y),r*_>=2&&(c++,_/=2),c+y>=v?(u=0,c=v):c+y>=1?(u=(r*_-1)*Math.pow(2,f),c=c+y):(u=r*Math.pow(2,y-1)*Math.pow(2,f),c=0));f>=8;n[i+g]=u&255,g+=k,u/=256,f-=8);for(c=c<<f|u,m+=f;m>0;n[i+g]=c&255,g+=k,c/=256,m-=8);n[i+g-k]|=x*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(n){var r=Ge,i=dt,o=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;n.Buffer=u,n.SlowBuffer=Z,n.INSPECT_MAX_BYTES=50;var f=2147483647;n.kMaxLength=f,u.TYPED_ARRAY_SUPPORT=l(),!u.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function l(){try{var s=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(s,e),s.foo()===42}catch{return!1}}Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(!!u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(!!u.isBuffer(this))return this.byteOffset}});function c(s){if(s>f)throw new RangeError('The value "'+s+'" is invalid for option "size"');var e=new Uint8Array(s);return Object.setPrototypeOf(e,u.prototype),e}function u(s,e,t){if(typeof s=="number"){if(typeof e=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return y(s)}return _(s,e,t)}u.poolSize=8192;function _(s,e,t){if(typeof s=="string")return b(s,e);if(ArrayBuffer.isView(s))return k(s);if(s==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof s);if(z(s,ArrayBuffer)||s&&z(s.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(z(s,SharedArrayBuffer)||s&&z(s.buffer,SharedArrayBuffer)))return x(s,e,t);if(typeof s=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var a=s.valueOf&&s.valueOf();if(a!=null&&a!==s)return u.from(a,e,t);var h=L(s);if(h)return h;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof s[Symbol.toPrimitive]=="function")return u.from(s[Symbol.toPrimitive]("string"),e,t);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof s)}u.from=function(s,e,t){return _(s,e,t)},Object.setPrototypeOf(u.prototype,Uint8Array.prototype),Object.setPrototypeOf(u,Uint8Array);function m(s){if(typeof s!="number")throw new TypeError('"size" argument must be of type number');if(s<0)throw new RangeError('The value "'+s+'" is invalid for option "size"')}function v(s,e,t){return m(s),s<=0?c(s):e!==void 0?typeof t=="string"?c(s).fill(e,t):c(s).fill(e):c(s)}u.alloc=function(s,e,t){return v(s,e,t)};function y(s){return m(s),c(s<0?0:W(s)|0)}u.allocUnsafe=function(s){return y(s)},u.allocUnsafeSlow=function(s){return y(s)};function b(s,e){if((typeof e!="string"||e==="")&&(e="utf8"),!u.isEncoding(e))throw new TypeError("Unknown encoding: "+e);var t=H(s,e)|0,a=c(t),h=a.write(s,e);return h!==t&&(a=a.slice(0,h)),a}function g(s){for(var e=s.length<0?0:W(s.length)|0,t=c(e),a=0;a<e;a+=1)t[a]=s[a]&255;return t}function k(s){if(z(s,Uint8Array)){var e=new Uint8Array(s);return x(e.buffer,e.byteOffset,e.byteLength)}return g(s)}function x(s,e,t){if(e<0||s.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(s.byteLength<e+(t||0))throw new RangeError('"length" is outside of buffer bounds');var a;return e===void 0&&t===void 0?a=new Uint8Array(s):t===void 0?a=new Uint8Array(s,e):a=new Uint8Array(s,e,t),Object.setPrototypeOf(a,u.prototype),a}function L(s){if(u.isBuffer(s)){var e=W(s.length)|0,t=c(e);return t.length===0||s.copy(t,0,0,e),t}if(s.length!==void 0)return typeof s.length!="number"||Qe(s.length)?c(0):g(s);if(s.type==="Buffer"&&Array.isArray(s.data))return g(s.data)}function W(s){if(s>=f)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+f.toString(16)+" bytes");return s|0}function Z(s){return+s!=s&&(s=0),u.alloc(+s)}u.isBuffer=function(e){return e!=null&&e._isBuffer===!0&&e!==u.prototype},u.compare=function(e,t){if(z(e,Uint8Array)&&(e=u.from(e,e.offset,e.byteLength)),z(t,Uint8Array)&&(t=u.from(t,t.offset,t.byteLength)),!u.isBuffer(e)||!u.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var a=e.length,h=t.length,p=0,d=Math.min(a,h);p<d;++p)if(e[p]!==t[p]){a=e[p],h=t[p];break}return a<h?-1:h<a?1:0},u.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(e.length===0)return u.alloc(0);var a;if(t===void 0)for(t=0,a=0;a<e.length;++a)t+=e[a].length;var h=u.allocUnsafe(t),p=0;for(a=0;a<e.length;++a){var d=e[a];if(z(d,Uint8Array))p+d.length>h.length?u.from(d).copy(h,p):Uint8Array.prototype.set.call(h,d,p);else if(u.isBuffer(d))d.copy(h,p);else throw new TypeError('"list" argument must be an Array of Buffers');p+=d.length}return h};function H(s,e){if(u.isBuffer(s))return s.length;if(ArrayBuffer.isView(s)||z(s,ArrayBuffer))return s.byteLength;if(typeof s!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof s);var t=s.length,a=arguments.length>2&&arguments[2]===!0;if(!a&&t===0)return 0;for(var h=!1;;)switch(e){case"ascii":case"latin1":case"binary":return t;case"utf8":case"utf-8":return Je(s).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return t*2;case"hex":return t>>>1;case"base64":return mt(s).length;default:if(h)return a?-1:Je(s).length;e=(""+e).toLowerCase(),h=!0}}u.byteLength=H;function V(s,e,t){var a=!1;if((e===void 0||e<0)&&(e=0),e>this.length||((t===void 0||t>this.length)&&(t=this.length),t<=0)||(t>>>=0,e>>>=0,t<=e))return"";for(s||(s="utf8");;)switch(s){case"hex":return _e(this,e,t);case"utf8":case"utf-8":return I(this,e,t);case"ascii":return Ke(this,e,t);case"latin1":case"binary":return Te(this,e,t);case"base64":return E(this,e,t);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Ze(this,e,t);default:if(a)throw new TypeError("Unknown encoding: "+s);s=(s+"").toLowerCase(),a=!0}}u.prototype._isBuffer=!0;function j(s,e,t){var a=s[e];s[e]=s[t],s[t]=a}u.prototype.swap16=function(){var e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)j(this,t,t+1);return this},u.prototype.swap32=function(){var e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)j(this,t,t+3),j(this,t+1,t+2);return this},u.prototype.swap64=function(){var e=this.length;if(e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)j(this,t,t+7),j(this,t+1,t+6),j(this,t+2,t+5),j(this,t+3,t+4);return this},u.prototype.toString=function(){var e=this.length;return e===0?"":arguments.length===0?I(this,0,e):V.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(e){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e?!0:u.compare(this,e)===0},u.prototype.inspect=function(){var e="",t=n.INSPECT_MAX_BYTES;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"},o&&(u.prototype[o]=u.prototype.inspect),u.prototype.compare=function(e,t,a,h,p){if(z(e,Uint8Array)&&(e=u.from(e,e.offset,e.byteLength)),!u.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(t===void 0&&(t=0),a===void 0&&(a=e?e.length:0),h===void 0&&(h=0),p===void 0&&(p=this.length),t<0||a>e.length||h<0||p>this.length)throw new RangeError("out of range index");if(h>=p&&t>=a)return 0;if(h>=p)return-1;if(t>=a)return 1;if(t>>>=0,a>>>=0,h>>>=0,p>>>=0,this===e)return 0;for(var d=p-h,S=a-t,B=Math.min(d,S),C=this.slice(h,p),D=e.slice(t,a),F=0;F<B;++F)if(C[F]!==D[F]){d=C[F],S=D[F];break}return d<S?-1:S<d?1:0};function te(s,e,t,a,h){if(s.length===0)return-1;if(typeof t=="string"?(a=t,t=0):t>2147483647?t=2147483647:t<-2147483648&&(t=-2147483648),t=+t,Qe(t)&&(t=h?0:s.length-1),t<0&&(t=s.length+t),t>=s.length){if(h)return-1;t=s.length-1}else if(t<0)if(h)t=0;else return-1;if(typeof e=="string"&&(e=u.from(e,a)),u.isBuffer(e))return e.length===0?-1:re(s,e,t,a,h);if(typeof e=="number")return e=e&255,typeof Uint8Array.prototype.indexOf=="function"?h?Uint8Array.prototype.indexOf.call(s,e,t):Uint8Array.prototype.lastIndexOf.call(s,e,t):re(s,[e],t,a,h);throw new TypeError("val must be string, number or Buffer")}function re(s,e,t,a,h){var p=1,d=s.length,S=e.length;if(a!==void 0&&(a=String(a).toLowerCase(),a==="ucs2"||a==="ucs-2"||a==="utf16le"||a==="utf-16le")){if(s.length<2||e.length<2)return-1;p=2,d/=2,S/=2,t/=2}function B(yt,vt){return p===1?yt[vt]:yt.readUInt16BE(vt*p)}var C;if(h){var D=-1;for(C=t;C<d;C++)if(B(s,C)===B(e,D===-1?0:C-D)){if(D===-1&&(D=C),C-D+1===S)return D*p}else D!==-1&&(C-=C-D),D=-1}else for(t+S>d&&(t=d-S),C=t;C>=0;C--){for(var F=!0,Ue=0;Ue<S;Ue++)if(B(s,C+Ue)!==B(e,Ue)){F=!1;break}if(F)return C}return-1}u.prototype.includes=function(e,t,a){return this.indexOf(e,t,a)!==-1},u.prototype.indexOf=function(e,t,a){return te(this,e,t,a,!0)},u.prototype.lastIndexOf=function(e,t,a){return te(this,e,t,a,!1)};function se(s,e,t,a){t=Number(t)||0;var h=s.length-t;a?(a=Number(a),a>h&&(a=h)):a=h;var p=e.length;a>p/2&&(a=p/2);for(var d=0;d<a;++d){var S=parseInt(e.substr(d*2,2),16);if(Qe(S))return d;s[t+d]=S}return d}function de(s,e,t,a){return Fe(Je(e,s.length-t),s,t,a)}function Xe(s,e,t,a){return Fe(yr(e),s,t,a)}function w(s,e,t,a){return Fe(mt(e),s,t,a)}function T(s,e,t,a){return Fe(vr(e,s.length-t),s,t,a)}u.prototype.write=function(e,t,a,h){if(t===void 0)h="utf8",a=this.length,t=0;else if(a===void 0&&typeof t=="string")h=t,a=this.length,t=0;else if(isFinite(t))t=t>>>0,isFinite(a)?(a=a>>>0,h===void 0&&(h="utf8")):(h=a,a=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var p=this.length-t;if((a===void 0||a>p)&&(a=p),e.length>0&&(a<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");h||(h="utf8");for(var d=!1;;)switch(h){case"hex":return se(this,e,t,a);case"utf8":case"utf-8":return de(this,e,t,a);case"ascii":case"latin1":case"binary":return Xe(this,e,t,a);case"base64":return w(this,e,t,a);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return T(this,e,t,a);default:if(d)throw new TypeError("Unknown encoding: "+h);h=(""+h).toLowerCase(),d=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function E(s,e,t){return e===0&&t===s.length?r.fromByteArray(s):r.fromByteArray(s.slice(e,t))}function I(s,e,t){t=Math.min(s.length,t);for(var a=[],h=e;h<t;){var p=s[h],d=null,S=p>239?4:p>223?3:p>191?2:1;if(h+S<=t){var B,C,D,F;switch(S){case 1:p<128&&(d=p);break;case 2:B=s[h+1],(B&192)===128&&(F=(p&31)<<6|B&63,F>127&&(d=F));break;case 3:B=s[h+1],C=s[h+2],(B&192)===128&&(C&192)===128&&(F=(p&15)<<12|(B&63)<<6|C&63,F>2047&&(F<55296||F>57343)&&(d=F));break;case 4:B=s[h+1],C=s[h+2],D=s[h+3],(B&192)===128&&(C&192)===128&&(D&192)===128&&(F=(p&15)<<18|(B&63)<<12|(C&63)<<6|D&63,F>65535&&F<1114112&&(d=F))}}d===null?(d=65533,S=1):d>65535&&(d-=65536,a.push(d>>>10&1023|55296),d=56320|d&1023),a.push(d),h+=S}return N(a)}var J=4096;function N(s){var e=s.length;if(e<=J)return String.fromCharCode.apply(String,s);for(var t="",a=0;a<e;)t+=String.fromCharCode.apply(String,s.slice(a,a+=J));return t}function Ke(s,e,t){var a="";t=Math.min(s.length,t);for(var h=e;h<t;++h)a+=String.fromCharCode(s[h]&127);return a}function Te(s,e,t){var a="";t=Math.min(s.length,t);for(var h=e;h<t;++h)a+=String.fromCharCode(s[h]);return a}function _e(s,e,t){var a=s.length;(!e||e<0)&&(e=0),(!t||t<0||t>a)&&(t=a);for(var h="",p=e;p<t;++p)h+=gr[s[p]];return h}function Ze(s,e,t){for(var a=s.slice(e,t),h="",p=0;p<a.length-1;p+=2)h+=String.fromCharCode(a[p]+a[p+1]*256);return h}u.prototype.slice=function(e,t){var a=this.length;e=~~e,t=t===void 0?a:~~t,e<0?(e+=a,e<0&&(e=0)):e>a&&(e=a),t<0?(t+=a,t<0&&(t=0)):t>a&&(t=a),t<e&&(t=e);var h=this.subarray(e,t);return Object.setPrototypeOf(h,u.prototype),h};function O(s,e,t){if(s%1!==0||s<0)throw new RangeError("offset is not uint");if(s+e>t)throw new RangeError("Trying to access beyond buffer length")}u.prototype.readUintLE=u.prototype.readUIntLE=function(e,t,a){e=e>>>0,t=t>>>0,a||O(e,t,this.length);for(var h=this[e],p=1,d=0;++d<t&&(p*=256);)h+=this[e+d]*p;return h},u.prototype.readUintBE=u.prototype.readUIntBE=function(e,t,a){e=e>>>0,t=t>>>0,a||O(e,t,this.length);for(var h=this[e+--t],p=1;t>0&&(p*=256);)h+=this[e+--t]*p;return h},u.prototype.readUint8=u.prototype.readUInt8=function(e,t){return e=e>>>0,t||O(e,1,this.length),this[e]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(e,t){return e=e>>>0,t||O(e,2,this.length),this[e]|this[e+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(e,t){return e=e>>>0,t||O(e,2,this.length),this[e]<<8|this[e+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(e,t){return e=e>>>0,t||O(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+this[e+3]*16777216},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(e,t){return e=e>>>0,t||O(e,4,this.length),this[e]*16777216+(this[e+1]<<16|this[e+2]<<8|this[e+3])},u.prototype.readIntLE=function(e,t,a){e=e>>>0,t=t>>>0,a||O(e,t,this.length);for(var h=this[e],p=1,d=0;++d<t&&(p*=256);)h+=this[e+d]*p;return p*=128,h>=p&&(h-=Math.pow(2,8*t)),h},u.prototype.readIntBE=function(e,t,a){e=e>>>0,t=t>>>0,a||O(e,t,this.length);for(var h=t,p=1,d=this[e+--h];h>0&&(p*=256);)d+=this[e+--h]*p;return p*=128,d>=p&&(d-=Math.pow(2,8*t)),d},u.prototype.readInt8=function(e,t){return e=e>>>0,t||O(e,1,this.length),this[e]&128?(255-this[e]+1)*-1:this[e]},u.prototype.readInt16LE=function(e,t){e=e>>>0,t||O(e,2,this.length);var a=this[e]|this[e+1]<<8;return a&32768?a|4294901760:a},u.prototype.readInt16BE=function(e,t){e=e>>>0,t||O(e,2,this.length);var a=this[e+1]|this[e]<<8;return a&32768?a|4294901760:a},u.prototype.readInt32LE=function(e,t){return e=e>>>0,t||O(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},u.prototype.readInt32BE=function(e,t){return e=e>>>0,t||O(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},u.prototype.readFloatLE=function(e,t){return e=e>>>0,t||O(e,4,this.length),i.read(this,e,!0,23,4)},u.prototype.readFloatBE=function(e,t){return e=e>>>0,t||O(e,4,this.length),i.read(this,e,!1,23,4)},u.prototype.readDoubleLE=function(e,t){return e=e>>>0,t||O(e,8,this.length),i.read(this,e,!0,52,8)},u.prototype.readDoubleBE=function(e,t){return e=e>>>0,t||O(e,8,this.length),i.read(this,e,!1,52,8)};function M(s,e,t,a,h,p){if(!u.isBuffer(s))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>h||e<p)throw new RangeError('"value" argument is out of bounds');if(t+a>s.length)throw new RangeError("Index out of range")}u.prototype.writeUintLE=u.prototype.writeUIntLE=function(e,t,a,h){if(e=+e,t=t>>>0,a=a>>>0,!h){var p=Math.pow(2,8*a)-1;M(this,e,t,a,p,0)}var d=1,S=0;for(this[t]=e&255;++S<a&&(d*=256);)this[t+S]=e/d&255;return t+a},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(e,t,a,h){if(e=+e,t=t>>>0,a=a>>>0,!h){var p=Math.pow(2,8*a)-1;M(this,e,t,a,p,0)}var d=a-1,S=1;for(this[t+d]=e&255;--d>=0&&(S*=256);)this[t+d]=e/S&255;return t+a},u.prototype.writeUint8=u.prototype.writeUInt8=function(e,t,a){return e=+e,t=t>>>0,a||M(this,e,t,1,255,0),this[t]=e&255,t+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(e,t,a){return e=+e,t=t>>>0,a||M(this,e,t,2,65535,0),this[t]=e&255,this[t+1]=e>>>8,t+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(e,t,a){return e=+e,t=t>>>0,a||M(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=e&255,t+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(e,t,a){return e=+e,t=t>>>0,a||M(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=e&255,t+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(e,t,a){return e=+e,t=t>>>0,a||M(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=e&255,t+4},u.prototype.writeIntLE=function(e,t,a,h){if(e=+e,t=t>>>0,!h){var p=Math.pow(2,8*a-1);M(this,e,t,a,p-1,-p)}var d=0,S=1,B=0;for(this[t]=e&255;++d<a&&(S*=256);)e<0&&B===0&&this[t+d-1]!==0&&(B=1),this[t+d]=(e/S>>0)-B&255;return t+a},u.prototype.writeIntBE=function(e,t,a,h){if(e=+e,t=t>>>0,!h){var p=Math.pow(2,8*a-1);M(this,e,t,a,p-1,-p)}var d=a-1,S=1,B=0;for(this[t+d]=e&255;--d>=0&&(S*=256);)e<0&&B===0&&this[t+d+1]!==0&&(B=1),this[t+d]=(e/S>>0)-B&255;return t+a},u.prototype.writeInt8=function(e,t,a){return e=+e,t=t>>>0,a||M(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=e&255,t+1},u.prototype.writeInt16LE=function(e,t,a){return e=+e,t=t>>>0,a||M(this,e,t,2,32767,-32768),this[t]=e&255,this[t+1]=e>>>8,t+2},u.prototype.writeInt16BE=function(e,t,a){return e=+e,t=t>>>0,a||M(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=e&255,t+2},u.prototype.writeInt32LE=function(e,t,a){return e=+e,t=t>>>0,a||M(this,e,t,4,2147483647,-2147483648),this[t]=e&255,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},u.prototype.writeInt32BE=function(e,t,a){return e=+e,t=t>>>0,a||M(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=e&255,t+4};function Be(s,e,t,a,h,p){if(t+a>s.length)throw new RangeError("Index out of range");if(t<0)throw new RangeError("Index out of range")}function Ce(s,e,t,a,h){return e=+e,t=t>>>0,h||Be(s,e,t,4),i.write(s,e,t,a,23,4),t+4}u.prototype.writeFloatLE=function(e,t,a){return Ce(this,e,t,!0,a)},u.prototype.writeFloatBE=function(e,t,a){return Ce(this,e,t,!1,a)};function me(s,e,t,a,h){return e=+e,t=t>>>0,h||Be(s,e,t,8),i.write(s,e,t,a,52,8),t+8}u.prototype.writeDoubleLE=function(e,t,a){return me(this,e,t,!0,a)},u.prototype.writeDoubleBE=function(e,t,a){return me(this,e,t,!1,a)},u.prototype.copy=function(e,t,a,h){if(!u.isBuffer(e))throw new TypeError("argument should be a Buffer");if(a||(a=0),!h&&h!==0&&(h=this.length),t>=e.length&&(t=e.length),t||(t=0),h>0&&h<a&&(h=a),h===a||e.length===0||this.length===0)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(a<0||a>=this.length)throw new RangeError("Index out of range");if(h<0)throw new RangeError("sourceEnd out of bounds");h>this.length&&(h=this.length),e.length-t<h-a&&(h=e.length-t+a);var p=h-a;return this===e&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(t,a,h):Uint8Array.prototype.set.call(e,this.subarray(a,h),t),p},u.prototype.fill=function(e,t,a,h){if(typeof e=="string"){if(typeof t=="string"?(h=t,t=0,a=this.length):typeof a=="string"&&(h=a,a=this.length),h!==void 0&&typeof h!="string")throw new TypeError("encoding must be a string");if(typeof h=="string"&&!u.isEncoding(h))throw new TypeError("Unknown encoding: "+h);if(e.length===1){var p=e.charCodeAt(0);(h==="utf8"&&p<128||h==="latin1")&&(e=p)}}else typeof e=="number"?e=e&255:typeof e=="boolean"&&(e=Number(e));if(t<0||this.length<t||this.length<a)throw new RangeError("Out of range index");if(a<=t)return this;t=t>>>0,a=a===void 0?this.length:a>>>0,e||(e=0);var d;if(typeof e=="number")for(d=t;d<a;++d)this[d]=e;else{var S=u.isBuffer(e)?e:u.from(e,h),B=S.length;if(B===0)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(d=0;d<a-t;++d)this[d+t]=S[d%B]}return this};var _r=/[^+/0-9A-Za-z-_]/g;function mr(s){if(s=s.split("=")[0],s=s.trim().replace(_r,""),s.length<2)return"";for(;s.length%4!==0;)s=s+"=";return s}function Je(s,e){e=e||1/0;for(var t,a=s.length,h=null,p=[],d=0;d<a;++d){if(t=s.charCodeAt(d),t>55295&&t<57344){if(!h){if(t>56319){(e-=3)>-1&&p.push(239,191,189);continue}else if(d+1===a){(e-=3)>-1&&p.push(239,191,189);continue}h=t;continue}if(t<56320){(e-=3)>-1&&p.push(239,191,189),h=t;continue}t=(h-55296<<10|t-56320)+65536}else h&&(e-=3)>-1&&p.push(239,191,189);if(h=null,t<128){if((e-=1)<0)break;p.push(t)}else if(t<2048){if((e-=2)<0)break;p.push(t>>6|192,t&63|128)}else if(t<65536){if((e-=3)<0)break;p.push(t>>12|224,t>>6&63|128,t&63|128)}else if(t<1114112){if((e-=4)<0)break;p.push(t>>18|240,t>>12&63|128,t>>6&63|128,t&63|128)}else throw new Error("Invalid code point")}return p}function yr(s){for(var e=[],t=0;t<s.length;++t)e.push(s.charCodeAt(t)&255);return e}function vr(s,e){for(var t,a,h,p=[],d=0;d<s.length&&!((e-=2)<0);++d)t=s.charCodeAt(d),a=t>>8,h=t%256,p.push(h),p.push(a);return p}function mt(s){return r.toByteArray(mr(s))}function Fe(s,e,t,a){for(var h=0;h<a&&!(h+t>=e.length||h>=s.length);++h)e[h+t]=s[h];return h}function z(s,e){return s instanceof e||s!=null&&s.constructor!=null&&s.constructor.name!=null&&s.constructor.name===e.name}function Qe(s){return s!==s}var gr=function(){for(var s="0123456789abcdef",e=new Array(256),t=0;t<16;++t)for(var a=t*16,h=0;h<16;++h)e[a+h]=s[t]+s[h];return e}()})(Xt);function be(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function Cr(n){if(n.__esModule)return n;var r=n.default;if(typeof r=="function"){var i=function o(){return this instanceof o?Reflect.construct(r,arguments,this.constructor):r.apply(this,arguments)};i.prototype=r.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(n).forEach(function(o){var f=Object.getOwnPropertyDescriptor(n,o);Object.defineProperty(i,o,f.get?f:{enumerable:!0,get:function(){return n[o]}})}),i}const{Duplex:Fr}=P;function gt(n){n.emit("close")}function Ur(){!this.destroyed&&this._writableState.finished&&this.destroy()}function Zt(n){this.removeListener("error",Zt),this.destroy(),this.listenerCount("error")===0&&this.emit("error",n)}function Or(n,r){let i=!0;const o=new Fr({...r,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return n.on("message",function(l,c){const u=!c&&o._readableState.objectMode?l.toString():l;o.push(u)||n.pause()}),n.once("error",function(l){o.destroyed||(i=!1,o.destroy(l))}),n.once("close",function(){o.destroyed||o.push(null)}),o._destroy=function(f,l){if(n.readyState===n.CLOSED){l(f),process.nextTick(gt,o);return}let c=!1;n.once("error",function(_){c=!0,l(_)}),n.once("close",function(){c||l(f),process.nextTick(gt,o)}),i&&n.terminate()},o._final=function(f){if(n.readyState===n.CONNECTING){n.once("open",function(){o._final(f)});return}n._socket!==null&&(n._socket._writableState.finished?(f(),o._readableState.endEmitted&&o.destroy()):(n._socket.once("finish",function(){f()}),n.close()))},o._read=function(){n.isPaused&&n.resume()},o._write=function(f,l,c){if(n.readyState===n.CONNECTING){n.once("open",function(){o._write(f,l,c)});return}n.send(f,c)},o.on("end",Ur),o.on("error",Zt),o}var Lr=Or;const an=be(Lr);var De={exports:{}},le={BINARY_TYPES:["nodebuffer","arraybuffer","fragments"],EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}},Oe={exports:{}},Le={exports:{}};function Nr(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var tt,xt;function Ar(){if(xt)return tt;xt=1;var n=P,r=P,i=P,o=typeof __webpack_require__=="function"?__non_webpack_require__:Nr,f=process.config&&process.config.variables||{},l=!!{}.PREBUILDS_ONLY,c=process.versions.modules,u=de()?"electron":se()?"node-webkit":"node",_={}.npm_config_arch||i.arch(),m={}.npm_config_platform||i.platform(),v={}.LIBC||(Xe(m)?"musl":"glibc"),y={}.ARM_VERSION||(_==="arm64"?"8":f.arm_version)||"",b=(process.versions.uv||"").split(".")[0];tt=g;function g(w){return o(g.resolve(w))}g.resolve=g.path=function(w){w=r.resolve(w||".");try{var T=o(r.join(w,"package.json")).name.toUpperCase().replace(/-/g,"_");process.env[T+"_PREBUILD"]&&(w=process.env[T+"_PREBUILD"])}catch{}if(!l){var E=x(r.join(w,"build/Release"),L);if(E)return E;var I=x(r.join(w,"build/Debug"),L);if(I)return I}var J=Te(w);if(J)return J;var N=Te(r.dirname(process.execPath));if(N)return N;var Ke=["platform="+m,"arch="+_,"runtime="+u,"abi="+c,"uv="+b,y?"armv="+y:"","libc="+v,"node="+process.versions.node,process.versions.electron?"electron="+process.versions.electron:"",typeof __webpack_require__=="function"?"webpack=true":""].filter(Boolean).join(" ");throw new Error("No native build was found for "+Ke+`
    loaded from: `+w+`
`);function Te(_e){var Ze=k(r.join(_e,"prebuilds")).map(W),O=Ze.filter(Z(m,_)).sort(H)[0];if(!!O){var M=r.join(_e,"prebuilds",O.name),Be=k(M).map(V),Ce=Be.filter(j(u,c)),me=Ce.sort(re(u))[0];if(me)return r.join(M,me.file)}}};function k(w){try{return n.readdirSync(w)}catch{return[]}}function x(w,T){var E=k(w).filter(T);return E[0]&&r.join(w,E[0])}function L(w){return/\.node$/.test(w)}function W(w){var T=w.split("-");if(T.length===2){var E=T[0],I=T[1].split("+");if(!!E&&!!I.length&&!!I.every(Boolean))return{name:w,platform:E,architectures:I}}}function Z(w,T){return function(E){return E==null||E.platform!==w?!1:E.architectures.includes(T)}}function H(w,T){return w.architectures.length-T.architectures.length}function V(w){var T=w.split("."),E=T.pop(),I={file:w,specificity:0};if(E==="node"){for(var J=0;J<T.length;J++){var N=T[J];if(N==="node"||N==="electron"||N==="node-webkit")I.runtime=N;else if(N==="napi")I.napi=!0;else if(N.slice(0,3)==="abi")I.abi=N.slice(3);else if(N.slice(0,2)==="uv")I.uv=N.slice(2);else if(N.slice(0,4)==="armv")I.armv=N.slice(4);else if(N==="glibc"||N==="musl")I.libc=N;else continue;I.specificity++}return I}}function j(w,T){return function(E){return!(E==null||E.runtime!==w&&!te(E)||E.abi!==T&&!E.napi||E.uv&&E.uv!==b||E.armv&&E.armv!==y||E.libc&&E.libc!==v)}}function te(w){return w.runtime==="node"&&w.napi}function re(w){return function(T,E){return T.runtime!==E.runtime?T.runtime===w?-1:1:T.abi!==E.abi?T.abi?-1:1:T.specificity!==E.specificity?T.specificity>E.specificity?-1:1:0}}function se(){return!!(process.versions&&process.versions.nw)}function de(){return process.versions&&process.versions.electron||{}.ELECTRON_RUN_AS_NODE?!0:typeof window<"u"&&window.process&&window.process.type==="renderer"}function Xe(w){return w==="linux"&&n.existsSync("/etc/alpine-release")}return g.parseTags=V,g.matchTags=j,g.compareTags=re,g.parseTuple=W,g.matchTuple=Z,g.compareTuples=H,tt}var wt;function Ir(){return wt||(wt=1,typeof process.addon=="function"?Le.exports=process.addon.bind(process):Le.exports=Ar()),Le.exports}var rt,Et;function Rr(){return Et||(Et=1,rt={mask:(i,o,f,l,c)=>{for(var u=0;u<c;u++)f[l+u]=i[u]^o[u&3]},unmask:(i,o)=>{const f=i.length;for(var l=0;l<f;l++)i[l]^=o[l&3]}}),rt}var St;function Mr(){if(St)return Oe.exports;St=1;try{Oe.exports=Ir()(__dirname)}catch{Oe.exports=Rr()}return Oe.exports}var Pr,Dr;const{EMPTY_BUFFER:$r}=le,ht=Buffer[Symbol.species];function Wr(n,r){if(n.length===0)return $r;if(n.length===1)return n[0];const i=Buffer.allocUnsafe(r);let o=0;for(let f=0;f<n.length;f++){const l=n[f];i.set(l,o),o+=l.length}return o<r?new ht(i.buffer,i.byteOffset,o):i}function Jt(n,r,i,o,f){for(let l=0;l<f;l++)i[o+l]=n[l]^r[l&3]}function Qt(n,r){for(let i=0;i<n.length;i++)n[i]^=r[i&3]}function jr(n){return n.length===n.buffer.byteLength?n.buffer:n.buffer.slice(n.byteOffset,n.byteOffset+n.length)}function ct(n){if(ct.readOnly=!0,Buffer.isBuffer(n))return n;let r;return n instanceof ArrayBuffer?r=new ht(n):ArrayBuffer.isView(n)?r=new ht(n.buffer,n.byteOffset,n.byteLength):(r=Buffer.from(n),ct.readOnly=!1),r}De.exports={concat:Wr,mask:Jt,toArrayBuffer:jr,toBuffer:ct,unmask:Qt};if(!{}.WS_NO_BUFFER_UTIL)try{const n=Mr();Dr=De.exports.mask=function(r,i,o,f,l){l<48?Jt(r,i,o,f,l):n.mask(r,i,o,f,l)},Pr=De.exports.unmask=function(r,i){r.length<32?Qt(r,i):n.unmask(r,i)}}catch{}var Ve=De.exports;const bt=Symbol("kDone"),it=Symbol("kRun");let Gr=class{constructor(r){this[bt]=()=>{this.pending--,this[it]()},this.concurrency=r||1/0,this.jobs=[],this.pending=0}add(r){this.jobs.push(r),this[it]()}[it](){if(this.pending!==this.concurrency&&this.jobs.length){const r=this.jobs.shift();this.pending++,r(this[bt])}}};var Vr=Gr;const ye=P,kt=Ve,qr=Vr,{kStatusCode:er}=le,Hr=Buffer[Symbol.species],Yr=Buffer.from([0,0,255,255]),$e=Symbol("permessage-deflate"),Q=Symbol("total-length"),Ee=Symbol("callback"),ie=Symbol("buffers"),Me=Symbol("error");let Ne,zr=class{constructor(r,i,o){if(this._maxPayload=o|0,this._options=r||{},this._threshold=this._options.threshold!==void 0?this._options.threshold:1024,this._isServer=!!i,this._deflate=null,this._inflate=null,this.params=null,!Ne){const f=this._options.concurrencyLimit!==void 0?this._options.concurrencyLimit:10;Ne=new qr(f)}}static get extensionName(){return"permessage-deflate"}offer(){const r={};return this._options.serverNoContextTakeover&&(r.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(r.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(r.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?r.client_max_window_bits=this._options.clientMaxWindowBits:this._options.clientMaxWindowBits==null&&(r.client_max_window_bits=!0),r}accept(r){return r=this.normalizeParams(r),this.params=this._isServer?this.acceptAsServer(r):this.acceptAsClient(r),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){const r=this._deflate[Ee];this._deflate.close(),this._deflate=null,r&&r(new Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(r){const i=this._options,o=r.find(f=>!(i.serverNoContextTakeover===!1&&f.server_no_context_takeover||f.server_max_window_bits&&(i.serverMaxWindowBits===!1||typeof i.serverMaxWindowBits=="number"&&i.serverMaxWindowBits>f.server_max_window_bits)||typeof i.clientMaxWindowBits=="number"&&!f.client_max_window_bits));if(!o)throw new Error("None of the extension offers can be accepted");return i.serverNoContextTakeover&&(o.server_no_context_takeover=!0),i.clientNoContextTakeover&&(o.client_no_context_takeover=!0),typeof i.serverMaxWindowBits=="number"&&(o.server_max_window_bits=i.serverMaxWindowBits),typeof i.clientMaxWindowBits=="number"?o.client_max_window_bits=i.clientMaxWindowBits:(o.client_max_window_bits===!0||i.clientMaxWindowBits===!1)&&delete o.client_max_window_bits,o}acceptAsClient(r){const i=r[0];if(this._options.clientNoContextTakeover===!1&&i.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(!i.client_max_window_bits)typeof this._options.clientMaxWindowBits=="number"&&(i.client_max_window_bits=this._options.clientMaxWindowBits);else if(this._options.clientMaxWindowBits===!1||typeof this._options.clientMaxWindowBits=="number"&&i.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"');return i}normalizeParams(r){return r.forEach(i=>{Object.keys(i).forEach(o=>{let f=i[o];if(f.length>1)throw new Error(`Parameter "${o}" must have only a single value`);if(f=f[0],o==="client_max_window_bits"){if(f!==!0){const l=+f;if(!Number.isInteger(l)||l<8||l>15)throw new TypeError(`Invalid value for parameter "${o}": ${f}`);f=l}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${o}": ${f}`)}else if(o==="server_max_window_bits"){const l=+f;if(!Number.isInteger(l)||l<8||l>15)throw new TypeError(`Invalid value for parameter "${o}": ${f}`);f=l}else if(o==="client_no_context_takeover"||o==="server_no_context_takeover"){if(f!==!0)throw new TypeError(`Invalid value for parameter "${o}": ${f}`)}else throw new Error(`Unknown parameter "${o}"`);i[o]=f})}),r}decompress(r,i,o){Ne.add(f=>{this._decompress(r,i,(l,c)=>{f(),o(l,c)})})}compress(r,i,o){Ne.add(f=>{this._compress(r,i,(l,c)=>{f(),o(l,c)})})}_decompress(r,i,o){const f=this._isServer?"client":"server";if(!this._inflate){const l=`${f}_max_window_bits`,c=typeof this.params[l]!="number"?ye.Z_DEFAULT_WINDOWBITS:this.params[l];this._inflate=ye.createInflateRaw({...this._options.zlibInflateOptions,windowBits:c}),this._inflate[$e]=this,this._inflate[Q]=0,this._inflate[ie]=[],this._inflate.on("error",Kr),this._inflate.on("data",tr)}this._inflate[Ee]=o,this._inflate.write(r),i&&this._inflate.write(Yr),this._inflate.flush(()=>{const l=this._inflate[Me];if(l){this._inflate.close(),this._inflate=null,o(l);return}const c=kt.concat(this._inflate[ie],this._inflate[Q]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[Q]=0,this._inflate[ie]=[],i&&this.params[`${f}_no_context_takeover`]&&this._inflate.reset()),o(null,c)})}_compress(r,i,o){const f=this._isServer?"server":"client";if(!this._deflate){const l=`${f}_max_window_bits`,c=typeof this.params[l]!="number"?ye.Z_DEFAULT_WINDOWBITS:this.params[l];this._deflate=ye.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:c}),this._deflate[Q]=0,this._deflate[ie]=[],this._deflate.on("data",Xr)}this._deflate[Ee]=o,this._deflate.write(r),this._deflate.flush(ye.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let l=kt.concat(this._deflate[ie],this._deflate[Q]);i&&(l=new Hr(l.buffer,l.byteOffset,l.length-4)),this._deflate[Ee]=null,this._deflate[Q]=0,this._deflate[ie]=[],i&&this.params[`${f}_no_context_takeover`]&&this._deflate.reset(),o(null,l)})}};var qe=zr;function Xr(n){this[ie].push(n),this[Q]+=n.length}function tr(n){if(this[Q]+=n.length,this[$e]._maxPayload<1||this[Q]<=this[$e]._maxPayload){this[ie].push(n);return}this[Me]=new RangeError("Max payload size exceeded"),this[Me].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[Me][er]=1009,this.removeListener("data",tr),this.reset()}function Kr(n){this[$e]._inflate=null,n[er]=1007,this[Ee](n)}var We={exports:{}};const Zr={},Jr=Object.freeze(Object.defineProperty({__proto__:null,default:Zr},Symbol.toStringTag,{value:"Module"})),Qr=Cr(Jr);var Tt;const{isUtf8:Bt}=Xt,ei=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function ti(n){return n>=1e3&&n<=1014&&n!==1004&&n!==1005&&n!==1006||n>=3e3&&n<=4999}function pt(n){const r=n.length;let i=0;for(;i<r;)if((n[i]&128)===0)i++;else if((n[i]&224)===192){if(i+1===r||(n[i+1]&192)!==128||(n[i]&254)===192)return!1;i+=2}else if((n[i]&240)===224){if(i+2>=r||(n[i+1]&192)!==128||(n[i+2]&192)!==128||n[i]===224&&(n[i+1]&224)===128||n[i]===237&&(n[i+1]&224)===160)return!1;i+=3}else if((n[i]&248)===240){if(i+3>=r||(n[i+1]&192)!==128||(n[i+2]&192)!==128||(n[i+3]&192)!==128||n[i]===240&&(n[i+1]&240)===128||n[i]===244&&n[i+1]>143||n[i]>244)return!1;i+=4}else return!1;return!0}We.exports={isValidStatusCode:ti,isValidUTF8:pt,tokenChars:ei};if(Bt)Tt=We.exports.isValidUTF8=function(n){return n.length<24?pt(n):Bt(n)};else if(!{}.WS_NO_UTF_8_VALIDATE)try{const n=Qr;Tt=We.exports.isValidUTF8=function(r){return r.length<32?pt(r):n(r)}}catch{}var He=We.exports;const{Writable:ri}=P,Ct=qe,{BINARY_TYPES:ii,EMPTY_BUFFER:Ft,kStatusCode:ni,kWebSocket:si}=le,{concat:nt,toArrayBuffer:oi,unmask:ai}=Ve,{isValidStatusCode:fi,isValidUTF8:Ut}=He,Ae=Buffer[Symbol.species],ve=0,Ot=1,Lt=2,Nt=3,st=4,li=5;let ui=class extends ri{constructor(r={}){super(),this._binaryType=r.binaryType||ii[0],this._extensions=r.extensions||{},this._isServer=!!r.isServer,this._maxPayload=r.maxPayload|0,this._skipUTF8Validation=!!r.skipUTF8Validation,this[si]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._state=ve,this._loop=!1}_write(r,i,o){if(this._opcode===8&&this._state==ve)return o();this._bufferedBytes+=r.length,this._buffers.push(r),this.startLoop(o)}consume(r){if(this._bufferedBytes-=r,r===this._buffers[0].length)return this._buffers.shift();if(r<this._buffers[0].length){const o=this._buffers[0];return this._buffers[0]=new Ae(o.buffer,o.byteOffset+r,o.length-r),new Ae(o.buffer,o.byteOffset,r)}const i=Buffer.allocUnsafe(r);do{const o=this._buffers[0],f=i.length-r;r>=o.length?i.set(this._buffers.shift(),f):(i.set(new Uint8Array(o.buffer,o.byteOffset,r),f),this._buffers[0]=new Ae(o.buffer,o.byteOffset+r,o.length-r)),r-=o.length}while(r>0);return i}startLoop(r){let i;this._loop=!0;do switch(this._state){case ve:i=this.getInfo();break;case Ot:i=this.getPayloadLength16();break;case Lt:i=this.getPayloadLength64();break;case Nt:this.getMask();break;case st:i=this.getData(r);break;default:this._loop=!1;return}while(this._loop);r(i)}getInfo(){if(this._bufferedBytes<2){this._loop=!1;return}const r=this.consume(2);if((r[0]&48)!==0)return this._loop=!1,R(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3");const i=(r[0]&64)===64;if(i&&!this._extensions[Ct.extensionName])return this._loop=!1,R(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(this._fin=(r[0]&128)===128,this._opcode=r[0]&15,this._payloadLength=r[1]&127,this._opcode===0){if(i)return this._loop=!1,R(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(!this._fragmented)return this._loop=!1,R(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE");this._opcode=this._fragmented}else if(this._opcode===1||this._opcode===2){if(this._fragmented)return this._loop=!1,R(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");this._compressed=i}else if(this._opcode>7&&this._opcode<11){if(!this._fin)return this._loop=!1,R(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN");if(i)return this._loop=!1,R(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(this._payloadLength>125||this._opcode===8&&this._payloadLength===1)return this._loop=!1,R(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH")}else return this._loop=!1,R(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");if(!this._fin&&!this._fragmented&&(this._fragmented=this._opcode),this._masked=(r[1]&128)===128,this._isServer){if(!this._masked)return this._loop=!1,R(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK")}else if(this._masked)return this._loop=!1,R(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK");if(this._payloadLength===126)this._state=Ot;else if(this._payloadLength===127)this._state=Lt;else return this.haveLength()}getPayloadLength16(){if(this._bufferedBytes<2){this._loop=!1;return}return this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength()}getPayloadLength64(){if(this._bufferedBytes<8){this._loop=!1;return}const r=this.consume(8),i=r.readUInt32BE(0);return i>Math.pow(2,53-32)-1?(this._loop=!1,R(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH")):(this._payloadLength=i*Math.pow(2,32)+r.readUInt32BE(4),this.haveLength())}haveLength(){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0))return this._loop=!1,R(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");this._masked?this._state=Nt:this._state=st}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=st}getData(r){let i=Ft;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}i=this.consume(this._payloadLength),this._masked&&(this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3])!==0&&ai(i,this._mask)}if(this._opcode>7)return this.controlMessage(i);if(this._compressed){this._state=li,this.decompress(i,r);return}return i.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(i)),this.dataMessage()}decompress(r,i){this._extensions[Ct.extensionName].decompress(r,this._fin,(f,l)=>{if(f)return i(f);if(l.length){if(this._messageLength+=l.length,this._messageLength>this._maxPayload&&this._maxPayload>0)return i(R(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH"));this._fragments.push(l)}const c=this.dataMessage();if(c)return i(c);this.startLoop(i)})}dataMessage(){if(this._fin){const r=this._messageLength,i=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],this._opcode===2){let o;this._binaryType==="nodebuffer"?o=nt(i,r):this._binaryType==="arraybuffer"?o=oi(nt(i,r)):o=i,this.emit("message",o,!0)}else{const o=nt(i,r);if(!this._skipUTF8Validation&&!Ut(o))return this._loop=!1,R(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");this.emit("message",o,!1)}}this._state=ve}controlMessage(r){if(this._opcode===8)if(this._loop=!1,r.length===0)this.emit("conclude",1005,Ft),this.end();else{const i=r.readUInt16BE(0);if(!fi(i))return R(RangeError,`invalid status code ${i}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");const o=new Ae(r.buffer,r.byteOffset+2,r.length-2);if(!this._skipUTF8Validation&&!Ut(o))return R(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");this.emit("conclude",i,o),this.end()}else this._opcode===9?this.emit("ping",r):this.emit("pong",r);this._state=ve}};var rr=ui;function R(n,r,i,o,f){const l=new n(i?`Invalid WebSocket frame: ${r}`:r);return Error.captureStackTrace(l,R),l.code=f,l[ni]=o,l}const hn=be(rr),{randomFillSync:hi}=P,At=qe,{EMPTY_BUFFER:ci}=le,{isValidStatusCode:pi}=He,{mask:It,toBuffer:ce}=Ve,Y=Symbol("kByteLength"),di=Buffer.alloc(4);let _i=class ae{constructor(r,i,o){this._extensions=i||{},o&&(this._generateMask=o,this._maskBuffer=Buffer.alloc(4)),this._socket=r,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._deflating=!1,this._queue=[]}static frame(r,i){let o,f=!1,l=2,c=!1;i.mask&&(o=i.maskBuffer||di,i.generateMask?i.generateMask(o):hi(o,0,4),c=(o[0]|o[1]|o[2]|o[3])===0,l=6);let u;typeof r=="string"?(!i.mask||c)&&i[Y]!==void 0?u=i[Y]:(r=Buffer.from(r),u=r.length):(u=r.length,f=i.mask&&i.readOnly&&!c);let _=u;u>=65536?(l+=8,_=127):u>125&&(l+=2,_=126);const m=Buffer.allocUnsafe(f?u+l:l);return m[0]=i.fin?i.opcode|128:i.opcode,i.rsv1&&(m[0]|=64),m[1]=_,_===126?m.writeUInt16BE(u,2):_===127&&(m[2]=m[3]=0,m.writeUIntBE(u,4,6)),i.mask?(m[1]|=128,m[l-4]=o[0],m[l-3]=o[1],m[l-2]=o[2],m[l-1]=o[3],c?[m,r]:f?(It(r,o,m,l,u),[m]):(It(r,o,r,0,u),[m,r])):[m,r]}close(r,i,o,f){let l;if(r===void 0)l=ci;else{if(typeof r!="number"||!pi(r))throw new TypeError("First argument must be a valid error code number");if(i===void 0||!i.length)l=Buffer.allocUnsafe(2),l.writeUInt16BE(r,0);else{const u=Buffer.byteLength(i);if(u>123)throw new RangeError("The message must not be greater than 123 bytes");l=Buffer.allocUnsafe(2+u),l.writeUInt16BE(r,0),typeof i=="string"?l.write(i,2):l.set(i,2)}}const c={[Y]:l.length,fin:!0,generateMask:this._generateMask,mask:o,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};this._deflating?this.enqueue([this.dispatch,l,!1,c,f]):this.sendFrame(ae.frame(l,c),f)}ping(r,i,o){let f,l;if(typeof r=="string"?(f=Buffer.byteLength(r),l=!1):(r=ce(r),f=r.length,l=ce.readOnly),f>125)throw new RangeError("The data size must not be greater than 125 bytes");const c={[Y]:f,fin:!0,generateMask:this._generateMask,mask:i,maskBuffer:this._maskBuffer,opcode:9,readOnly:l,rsv1:!1};this._deflating?this.enqueue([this.dispatch,r,!1,c,o]):this.sendFrame(ae.frame(r,c),o)}pong(r,i,o){let f,l;if(typeof r=="string"?(f=Buffer.byteLength(r),l=!1):(r=ce(r),f=r.length,l=ce.readOnly),f>125)throw new RangeError("The data size must not be greater than 125 bytes");const c={[Y]:f,fin:!0,generateMask:this._generateMask,mask:i,maskBuffer:this._maskBuffer,opcode:10,readOnly:l,rsv1:!1};this._deflating?this.enqueue([this.dispatch,r,!1,c,o]):this.sendFrame(ae.frame(r,c),o)}send(r,i,o){const f=this._extensions[At.extensionName];let l=i.binary?2:1,c=i.compress,u,_;if(typeof r=="string"?(u=Buffer.byteLength(r),_=!1):(r=ce(r),u=r.length,_=ce.readOnly),this._firstFragment?(this._firstFragment=!1,c&&f&&f.params[f._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(c=u>=f._threshold),this._compress=c):(c=!1,l=0),i.fin&&(this._firstFragment=!0),f){const m={[Y]:u,fin:i.fin,generateMask:this._generateMask,mask:i.mask,maskBuffer:this._maskBuffer,opcode:l,readOnly:_,rsv1:c};this._deflating?this.enqueue([this.dispatch,r,this._compress,m,o]):this.dispatch(r,this._compress,m,o)}else this.sendFrame(ae.frame(r,{[Y]:u,fin:i.fin,generateMask:this._generateMask,mask:i.mask,maskBuffer:this._maskBuffer,opcode:l,readOnly:_,rsv1:!1}),o)}dispatch(r,i,o,f){if(!i){this.sendFrame(ae.frame(r,o),f);return}const l=this._extensions[At.extensionName];this._bufferedBytes+=o[Y],this._deflating=!0,l.compress(r,o.fin,(c,u)=>{if(this._socket.destroyed){const _=new Error("The socket was closed while data was being compressed");typeof f=="function"&&f(_);for(let m=0;m<this._queue.length;m++){const v=this._queue[m],y=v[v.length-1];typeof y=="function"&&y(_)}return}this._bufferedBytes-=o[Y],this._deflating=!1,o.readOnly=!1,this.sendFrame(ae.frame(u,o),f),this.dequeue()})}dequeue(){for(;!this._deflating&&this._queue.length;){const r=this._queue.shift();this._bufferedBytes-=r[3][Y],Reflect.apply(r[0],this,r.slice(1))}}enqueue(r){this._bufferedBytes+=r[3][Y],this._queue.push(r)}sendFrame(r,i){r.length===2?(this._socket.cork(),this._socket.write(r[0]),this._socket.write(r[1],i),this._socket.uncork()):this._socket.write(r[0],i)}};var ir=_i;const cn=be(ir),{kForOnEventAttribute:ge,kListener:ot}=le,Rt=Symbol("kCode"),Mt=Symbol("kData"),Pt=Symbol("kError"),Dt=Symbol("kMessage"),$t=Symbol("kReason"),pe=Symbol("kTarget"),Wt=Symbol("kType"),jt=Symbol("kWasClean");class ue{constructor(r){this[pe]=null,this[Wt]=r}get target(){return this[pe]}get type(){return this[Wt]}}Object.defineProperty(ue.prototype,"target",{enumerable:!0});Object.defineProperty(ue.prototype,"type",{enumerable:!0});class ke extends ue{constructor(r,i={}){super(r),this[Rt]=i.code===void 0?0:i.code,this[$t]=i.reason===void 0?"":i.reason,this[jt]=i.wasClean===void 0?!1:i.wasClean}get code(){return this[Rt]}get reason(){return this[$t]}get wasClean(){return this[jt]}}Object.defineProperty(ke.prototype,"code",{enumerable:!0});Object.defineProperty(ke.prototype,"reason",{enumerable:!0});Object.defineProperty(ke.prototype,"wasClean",{enumerable:!0});class Ye extends ue{constructor(r,i={}){super(r),this[Pt]=i.error===void 0?null:i.error,this[Dt]=i.message===void 0?"":i.message}get error(){return this[Pt]}get message(){return this[Dt]}}Object.defineProperty(Ye.prototype,"error",{enumerable:!0});Object.defineProperty(Ye.prototype,"message",{enumerable:!0});class _t extends ue{constructor(r,i={}){super(r),this[Mt]=i.data===void 0?null:i.data}get data(){return this[Mt]}}Object.defineProperty(_t.prototype,"data",{enumerable:!0});const mi={addEventListener(n,r,i={}){for(const f of this.listeners(n))if(!i[ge]&&f[ot]===r&&!f[ge])return;let o;if(n==="message")o=function(l,c){const u=new _t("message",{data:c?l:l.toString()});u[pe]=this,Ie(r,this,u)};else if(n==="close")o=function(l,c){const u=new ke("close",{code:l,reason:c.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});u[pe]=this,Ie(r,this,u)};else if(n==="error")o=function(l){const c=new Ye("error",{error:l,message:l.message});c[pe]=this,Ie(r,this,c)};else if(n==="open")o=function(){const l=new ue("open");l[pe]=this,Ie(r,this,l)};else return;o[ge]=!!i[ge],o[ot]=r,i.once?this.once(n,o):this.on(n,o)},removeEventListener(n,r){for(const i of this.listeners(n))if(i[ot]===r&&!i[ge]){this.removeListener(n,i);break}}};var yi={CloseEvent:ke,ErrorEvent:Ye,Event:ue,EventTarget:mi,MessageEvent:_t};function Ie(n,r,i){typeof n=="object"&&n.handleEvent?n.handleEvent.call(n,i):n.call(r,i)}const{tokenChars:xe}=He;function X(n,r,i){n[r]===void 0?n[r]=[i]:n[r].push(i)}function vi(n){const r=Object.create(null);let i=Object.create(null),o=!1,f=!1,l=!1,c,u,_=-1,m=-1,v=-1,y=0;for(;y<n.length;y++)if(m=n.charCodeAt(y),c===void 0)if(v===-1&&xe[m]===1)_===-1&&(_=y);else if(y!==0&&(m===32||m===9))v===-1&&_!==-1&&(v=y);else if(m===59||m===44){if(_===-1)throw new SyntaxError(`Unexpected character at index ${y}`);v===-1&&(v=y);const g=n.slice(_,v);m===44?(X(r,g,i),i=Object.create(null)):c=g,_=v=-1}else throw new SyntaxError(`Unexpected character at index ${y}`);else if(u===void 0)if(v===-1&&xe[m]===1)_===-1&&(_=y);else if(m===32||m===9)v===-1&&_!==-1&&(v=y);else if(m===59||m===44){if(_===-1)throw new SyntaxError(`Unexpected character at index ${y}`);v===-1&&(v=y),X(i,n.slice(_,v),!0),m===44&&(X(r,c,i),i=Object.create(null),c=void 0),_=v=-1}else if(m===61&&_!==-1&&v===-1)u=n.slice(_,y),_=v=-1;else throw new SyntaxError(`Unexpected character at index ${y}`);else if(f){if(xe[m]!==1)throw new SyntaxError(`Unexpected character at index ${y}`);_===-1?_=y:o||(o=!0),f=!1}else if(l)if(xe[m]===1)_===-1&&(_=y);else if(m===34&&_!==-1)l=!1,v=y;else if(m===92)f=!0;else throw new SyntaxError(`Unexpected character at index ${y}`);else if(m===34&&n.charCodeAt(y-1)===61)l=!0;else if(v===-1&&xe[m]===1)_===-1&&(_=y);else if(_!==-1&&(m===32||m===9))v===-1&&(v=y);else if(m===59||m===44){if(_===-1)throw new SyntaxError(`Unexpected character at index ${y}`);v===-1&&(v=y);let g=n.slice(_,v);o&&(g=g.replace(/\\/g,""),o=!1),X(i,u,g),m===44&&(X(r,c,i),i=Object.create(null),c=void 0),u=void 0,_=v=-1}else throw new SyntaxError(`Unexpected character at index ${y}`);if(_===-1||l||m===32||m===9)throw new SyntaxError("Unexpected end of input");v===-1&&(v=y);const b=n.slice(_,v);return c===void 0?X(r,b,i):(u===void 0?X(i,b,!0):o?X(i,u,b.replace(/\\/g,"")):X(i,u,b),X(r,c,i)),r}function gi(n){return Object.keys(n).map(r=>{let i=n[r];return Array.isArray(i)||(i=[i]),i.map(o=>[r].concat(Object.keys(o).map(f=>{let l=o[f];return Array.isArray(l)||(l=[l]),l.map(c=>c===!0?f:`${f}=${c}`).join("; ")})).join("; ")).join(", ")}).join(", ")}var nr={format:gi,parse:vi};const xi=P,wi=P,Ei=P,sr=P,Si=P,{randomBytes:bi,createHash:ki}=P,{URL:at}=P,ne=qe,Ti=rr,Bi=ir,{BINARY_TYPES:Gt,EMPTY_BUFFER:Re,GUID:Ci,kForOnEventAttribute:ft,kListener:Fi,kStatusCode:Ui,kWebSocket:$,NOOP:or}=le,{EventTarget:{addEventListener:Oi,removeEventListener:Li}}=yi,{format:Ni,parse:Ai}=nr,{toBuffer:Ii}=Ve,Ri=30*1e3,ar=Symbol("kAborted"),lt=[8,13],ee=["CONNECTING","OPEN","CLOSING","CLOSED"],Mi=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/;let A=class U extends xi{constructor(r,i,o){super(),this._binaryType=Gt[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=Re,this._closeTimer=null,this._extensions={},this._paused=!1,this._protocol="",this._readyState=U.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,r!==null?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,i===void 0?i=[]:Array.isArray(i)||(typeof i=="object"&&i!==null?(o=i,i=[]):i=[i]),lr(this,r,i,o)):this._isServer=!0}get binaryType(){return this._binaryType}set binaryType(r){!Gt.includes(r)||(this._binaryType=r,this._receiver&&(this._receiver._binaryType=r))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(r,i,o){const f=new Ti({binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:o.maxPayload,skipUTF8Validation:o.skipUTF8Validation});this._sender=new Bi(r,this._extensions,o.generateMask),this._receiver=f,this._socket=r,f[$]=this,r[$]=this,f.on("conclude",$i),f.on("drain",Wi),f.on("error",ji),f.on("message",Gi),f.on("ping",Vi),f.on("pong",qi),r.setTimeout(0),r.setNoDelay(),i.length>0&&r.unshift(i),r.on("close",hr),r.on("data",ze),r.on("end",cr),r.on("error",pr),this._readyState=U.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=U.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[ne.extensionName]&&this._extensions[ne.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=U.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(r,i){if(this.readyState!==U.CLOSED){if(this.readyState===U.CONNECTING){const o="WebSocket was closed before the connection was established";G(this,this._req,o);return}if(this.readyState===U.CLOSING){this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();return}this._readyState=U.CLOSING,this._sender.close(r,i,!this._isServer,o=>{o||(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),this._closeTimer=setTimeout(this._socket.destroy.bind(this._socket),Ri)}}pause(){this.readyState===U.CONNECTING||this.readyState===U.CLOSED||(this._paused=!0,this._socket.pause())}ping(r,i,o){if(this.readyState===U.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof r=="function"?(o=r,r=i=void 0):typeof i=="function"&&(o=i,i=void 0),typeof r=="number"&&(r=r.toString()),this.readyState!==U.OPEN){ut(this,r,o);return}i===void 0&&(i=!this._isServer),this._sender.ping(r||Re,i,o)}pong(r,i,o){if(this.readyState===U.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof r=="function"?(o=r,r=i=void 0):typeof i=="function"&&(o=i,i=void 0),typeof r=="number"&&(r=r.toString()),this.readyState!==U.OPEN){ut(this,r,o);return}i===void 0&&(i=!this._isServer),this._sender.pong(r||Re,i,o)}resume(){this.readyState===U.CONNECTING||this.readyState===U.CLOSED||(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(r,i,o){if(this.readyState===U.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof i=="function"&&(o=i,i={}),typeof r=="number"&&(r=r.toString()),this.readyState!==U.OPEN){ut(this,r,o);return}const f={binary:typeof r!="string",mask:!this._isServer,compress:!0,fin:!0,...i};this._extensions[ne.extensionName]||(f.compress=!1),this._sender.send(r||Re,f,o)}terminate(){if(this.readyState!==U.CLOSED){if(this.readyState===U.CONNECTING){const r="WebSocket was closed before the connection was established";G(this,this._req,r);return}this._socket&&(this._readyState=U.CLOSING,this._socket.destroy())}}};Object.defineProperty(A,"CONNECTING",{enumerable:!0,value:ee.indexOf("CONNECTING")});Object.defineProperty(A.prototype,"CONNECTING",{enumerable:!0,value:ee.indexOf("CONNECTING")});Object.defineProperty(A,"OPEN",{enumerable:!0,value:ee.indexOf("OPEN")});Object.defineProperty(A.prototype,"OPEN",{enumerable:!0,value:ee.indexOf("OPEN")});Object.defineProperty(A,"CLOSING",{enumerable:!0,value:ee.indexOf("CLOSING")});Object.defineProperty(A.prototype,"CLOSING",{enumerable:!0,value:ee.indexOf("CLOSING")});Object.defineProperty(A,"CLOSED",{enumerable:!0,value:ee.indexOf("CLOSED")});Object.defineProperty(A.prototype,"CLOSED",{enumerable:!0,value:ee.indexOf("CLOSED")});["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach(n=>{Object.defineProperty(A.prototype,n,{enumerable:!0})});["open","error","close","message"].forEach(n=>{Object.defineProperty(A.prototype,`on${n}`,{enumerable:!0,get(){for(const r of this.listeners(n))if(r[ft])return r[Fi];return null},set(r){for(const i of this.listeners(n))if(i[ft]){this.removeListener(n,i);break}typeof r=="function"&&this.addEventListener(n,r,{[ft]:!0})}})});A.prototype.addEventListener=Oi;A.prototype.removeEventListener=Li;var fr=A;function lr(n,r,i,o){const f={protocolVersion:lt[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...o,createConnection:void 0,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(!lt.includes(f.protocolVersion))throw new RangeError(`Unsupported protocol version: ${f.protocolVersion} (supported versions: ${lt.join(", ")})`);let l;if(r instanceof at)l=r,n._url=r.href;else{try{l=new at(r)}catch{throw new SyntaxError(`Invalid URL: ${r}`)}n._url=r}const c=l.protocol==="wss:",u=l.protocol==="ws+unix:";let _;if(l.protocol!=="ws:"&&!c&&!u?_=`The URL's protocol must be one of "ws:", "wss:", or "ws+unix:"`:u&&!l.pathname?_="The URL's pathname is empty":l.hash&&(_="The URL contains a fragment identifier"),_){const x=new SyntaxError(_);if(n._redirects===0)throw x;Pe(n,x);return}const m=c?443:80,v=bi(16).toString("base64"),y=c?wi.request:Ei.request,b=new Set;let g;if(f.createConnection=c?Di:Pi,f.defaultPort=f.defaultPort||m,f.port=l.port||m,f.host=l.hostname.startsWith("[")?l.hostname.slice(1,-1):l.hostname,f.headers={...f.headers,"Sec-WebSocket-Version":f.protocolVersion,"Sec-WebSocket-Key":v,Connection:"Upgrade",Upgrade:"websocket"},f.path=l.pathname+l.search,f.timeout=f.handshakeTimeout,f.perMessageDeflate&&(g=new ne(f.perMessageDeflate!==!0?f.perMessageDeflate:{},!1,f.maxPayload),f.headers["Sec-WebSocket-Extensions"]=Ni({[ne.extensionName]:g.offer()})),i.length){for(const x of i){if(typeof x!="string"||!Mi.test(x)||b.has(x))throw new SyntaxError("An invalid or duplicated subprotocol was specified");b.add(x)}f.headers["Sec-WebSocket-Protocol"]=i.join(",")}if(f.origin&&(f.protocolVersion<13?f.headers["Sec-WebSocket-Origin"]=f.origin:f.headers.Origin=f.origin),(l.username||l.password)&&(f.auth=`${l.username}:${l.password}`),u){const x=f.path.split(":");f.socketPath=x[0],f.path=x[1]}let k;if(f.followRedirects){if(n._redirects===0){n._originalIpc=u,n._originalSecure=c,n._originalHostOrSocketPath=u?f.socketPath:l.host;const x=o&&o.headers;if(o={...o,headers:{}},x)for(const[L,W]of Object.entries(x))o.headers[L.toLowerCase()]=W}else if(n.listenerCount("redirect")===0){const x=u?n._originalIpc?f.socketPath===n._originalHostOrSocketPath:!1:n._originalIpc?!1:l.host===n._originalHostOrSocketPath;(!x||n._originalSecure&&!c)&&(delete f.headers.authorization,delete f.headers.cookie,x||delete f.headers.host,f.auth=void 0)}f.auth&&!o.headers.authorization&&(o.headers.authorization="Basic "+Buffer.from(f.auth).toString("base64")),k=n._req=y(f),n._redirects&&n.emit("redirect",n.url,k)}else k=n._req=y(f);f.timeout&&k.on("timeout",()=>{G(n,k,"Opening handshake has timed out")}),k.on("error",x=>{k===null||k[ar]||(k=n._req=null,Pe(n,x))}),k.on("response",x=>{const L=x.headers.location,W=x.statusCode;if(L&&f.followRedirects&&W>=300&&W<400){if(++n._redirects>f.maxRedirects){G(n,k,"Maximum redirects exceeded");return}k.abort();let Z;try{Z=new at(L,r)}catch{const V=new SyntaxError(`Invalid URL: ${L}`);Pe(n,V);return}lr(n,Z,i,o)}else n.emit("unexpected-response",k,x)||G(n,k,`Unexpected server response: ${x.statusCode}`)}),k.on("upgrade",(x,L,W)=>{if(n.emit("upgrade",x),n.readyState!==A.CONNECTING)return;if(k=n._req=null,x.headers.upgrade.toLowerCase()!=="websocket"){G(n,L,"Invalid Upgrade header");return}const Z=ki("sha1").update(v+Ci).digest("base64");if(x.headers["sec-websocket-accept"]!==Z){G(n,L,"Invalid Sec-WebSocket-Accept header");return}const H=x.headers["sec-websocket-protocol"];let V;if(H!==void 0?b.size?b.has(H)||(V="Server sent an invalid subprotocol"):V="Server sent a subprotocol but none was requested":b.size&&(V="Server sent no subprotocol"),V){G(n,L,V);return}H&&(n._protocol=H);const j=x.headers["sec-websocket-extensions"];if(j!==void 0){if(!g){G(n,L,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");return}let te;try{te=Ai(j)}catch{G(n,L,"Invalid Sec-WebSocket-Extensions header");return}const re=Object.keys(te);if(re.length!==1||re[0]!==ne.extensionName){G(n,L,"Server indicated an extension that was not requested");return}try{g.accept(te[ne.extensionName])}catch{G(n,L,"Invalid Sec-WebSocket-Extensions header");return}n._extensions[ne.extensionName]=g}n.setSocket(L,W,{generateMask:f.generateMask,maxPayload:f.maxPayload,skipUTF8Validation:f.skipUTF8Validation})}),f.finishRequest?f.finishRequest(k,n):k.end()}function Pe(n,r){n._readyState=A.CLOSING,n.emit("error",r),n.emitClose()}function Pi(n){return n.path=n.socketPath,sr.connect(n)}function Di(n){return n.path=void 0,!n.servername&&n.servername!==""&&(n.servername=sr.isIP(n.host)?"":n.host),Si.connect(n)}function G(n,r,i){n._readyState=A.CLOSING;const o=new Error(i);Error.captureStackTrace(o,G),r.setHeader?(r[ar]=!0,r.abort(),r.socket&&!r.socket.destroyed&&r.socket.destroy(),process.nextTick(Pe,n,o)):(r.destroy(o),r.once("error",n.emit.bind(n,"error")),r.once("close",n.emitClose.bind(n)))}function ut(n,r,i){if(r){const o=Ii(r).length;n._socket?n._sender._bufferedBytes+=o:n._bufferedAmount+=o}if(i){const o=new Error(`WebSocket is not open: readyState ${n.readyState} (${ee[n.readyState]})`);process.nextTick(i,o)}}function $i(n,r){const i=this[$];i._closeFrameReceived=!0,i._closeMessage=r,i._closeCode=n,i._socket[$]!==void 0&&(i._socket.removeListener("data",ze),process.nextTick(ur,i._socket),n===1005?i.close():i.close(n,r))}function Wi(){const n=this[$];n.isPaused||n._socket.resume()}function ji(n){const r=this[$];r._socket[$]!==void 0&&(r._socket.removeListener("data",ze),process.nextTick(ur,r._socket),r.close(n[Ui])),r.emit("error",n)}function Vt(){this[$].emitClose()}function Gi(n,r){this[$].emit("message",n,r)}function Vi(n){const r=this[$];r.pong(n,!r._isServer,or),r.emit("ping",n)}function qi(n){this[$].emit("pong",n)}function ur(n){n.resume()}function hr(){const n=this[$];this.removeListener("close",hr),this.removeListener("data",ze),this.removeListener("end",cr),n._readyState=A.CLOSING;let r;!this._readableState.endEmitted&&!n._closeFrameReceived&&!n._receiver._writableState.errorEmitted&&(r=n._socket.read())!==null&&n._receiver.write(r),n._receiver.end(),this[$]=void 0,clearTimeout(n._closeTimer),n._receiver._writableState.finished||n._receiver._writableState.errorEmitted?n.emitClose():(n._receiver.on("error",Vt),n._receiver.on("finish",Vt))}function ze(n){this[$]._receiver.write(n)||this.pause()}function cr(){const n=this[$];n._readyState=A.CLOSING,n._receiver.end(),this.end()}function pr(){const n=this[$];this.removeListener("error",pr),this.on("error",or),n&&(n._readyState=A.CLOSING,this.destroy())}const pn=be(fr),{tokenChars:Hi}=He;function Yi(n){const r=new Set;let i=-1,o=-1,f=0;for(f;f<n.length;f++){const c=n.charCodeAt(f);if(o===-1&&Hi[c]===1)i===-1&&(i=f);else if(f!==0&&(c===32||c===9))o===-1&&i!==-1&&(o=f);else if(c===44){if(i===-1)throw new SyntaxError(`Unexpected character at index ${f}`);o===-1&&(o=f);const u=n.slice(i,o);if(r.has(u))throw new SyntaxError(`The "${u}" subprotocol is duplicated`);r.add(u),i=o=-1}else throw new SyntaxError(`Unexpected character at index ${f}`)}if(i===-1||o!==-1)throw new SyntaxError("Unexpected end of input");const l=n.slice(i,f);if(r.has(l))throw new SyntaxError(`The "${l}" subprotocol is duplicated`);return r.add(l),r}var zi={parse:Yi};const Xi=P,je=P,{createHash:Ki}=P,qt=nr,oe=qe,Zi=zi,Ji=fr,{GUID:Qi,kWebSocket:en}=le,tn=/^[+/0-9A-Za-z]{22}==$/,Ht=0,Yt=1,dr=2;class rn extends Xi{constructor(r,i){if(super(),r={maxPayload:100*1024*1024,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:Ji,...r},r.port==null&&!r.server&&!r.noServer||r.port!=null&&(r.server||r.noServer)||r.server&&r.noServer)throw new TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(r.port!=null?(this._server=je.createServer((o,f)=>{const l=je.STATUS_CODES[426];f.writeHead(426,{"Content-Length":l.length,"Content-Type":"text/plain"}),f.end(l)}),this._server.listen(r.port,r.host,r.backlog,i)):r.server&&(this._server=r.server),this._server){const o=this.emit.bind(this,"connection");this._removeListeners=sn(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(f,l,c)=>{this.handleUpgrade(f,l,c,o)}})}r.perMessageDeflate===!0&&(r.perMessageDeflate={}),r.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=r,this._state=Ht}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(r){if(this._state===dr){r&&this.once("close",()=>{r(new Error("The server is not running"))}),process.nextTick(we,this);return}if(r&&this.once("close",r),this._state!==Yt)if(this._state=Yt,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients?this.clients.size?this._shouldEmitClose=!0:process.nextTick(we,this):process.nextTick(we,this);else{const i=this._server;this._removeListeners(),this._removeListeners=this._server=null,i.close(()=>{we(this)})}}shouldHandle(r){if(this.options.path){const i=r.url.indexOf("?");if((i!==-1?r.url.slice(0,i):r.url)!==this.options.path)return!1}return!0}handleUpgrade(r,i,o,f){i.on("error",zt);const l=r.headers["sec-websocket-key"],c=+r.headers["sec-websocket-version"];if(r.method!=="GET"){fe(this,r,i,405,"Invalid HTTP method");return}if(r.headers.upgrade.toLowerCase()!=="websocket"){fe(this,r,i,400,"Invalid Upgrade header");return}if(!l||!tn.test(l)){fe(this,r,i,400,"Missing or invalid Sec-WebSocket-Key header");return}if(c!==8&&c!==13){fe(this,r,i,400,"Missing or invalid Sec-WebSocket-Version header");return}if(!this.shouldHandle(r)){Se(i,400);return}const u=r.headers["sec-websocket-protocol"];let _=new Set;if(u!==void 0)try{_=Zi.parse(u)}catch{fe(this,r,i,400,"Invalid Sec-WebSocket-Protocol header");return}const m=r.headers["sec-websocket-extensions"],v={};if(this.options.perMessageDeflate&&m!==void 0){const y=new oe(this.options.perMessageDeflate,!0,this.options.maxPayload);try{const b=qt.parse(m);b[oe.extensionName]&&(y.accept(b[oe.extensionName]),v[oe.extensionName]=y)}catch{fe(this,r,i,400,"Invalid or unacceptable Sec-WebSocket-Extensions header");return}}if(this.options.verifyClient){const y={origin:r.headers[`${c===8?"sec-websocket-origin":"origin"}`],secure:!!(r.socket.authorized||r.socket.encrypted),req:r};if(this.options.verifyClient.length===2){this.options.verifyClient(y,(b,g,k,x)=>{if(!b)return Se(i,g||401,k,x);this.completeUpgrade(v,l,_,r,i,o,f)});return}if(!this.options.verifyClient(y))return Se(i,401)}this.completeUpgrade(v,l,_,r,i,o,f)}completeUpgrade(r,i,o,f,l,c,u){if(!l.readable||!l.writable)return l.destroy();if(l[en])throw new Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>Ht)return Se(l,503);const _=Ki("sha1").update(i+Qi).digest("base64"),m=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${_}`],v=new this.options.WebSocket(null);if(o.size){const y=this.options.handleProtocols?this.options.handleProtocols(o,f):o.values().next().value;y&&(m.push(`Sec-WebSocket-Protocol: ${y}`),v._protocol=y)}if(r[oe.extensionName]){const y=r[oe.extensionName].params,b=qt.format({[oe.extensionName]:[y]});m.push(`Sec-WebSocket-Extensions: ${b}`),v._extensions=r}this.emit("headers",m,f),l.write(m.concat(`\r
`).join(`\r
`)),l.removeListener("error",zt),v.setSocket(l,c,{maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(v),v.on("close",()=>{this.clients.delete(v),this._shouldEmitClose&&!this.clients.size&&process.nextTick(we,this)})),u(v,f)}}var nn=rn;function sn(n,r){for(const i of Object.keys(r))n.on(i,r[i]);return function(){for(const o of Object.keys(r))n.removeListener(o,r[o])}}function we(n){n._state=dr,n.emit("close")}function zt(){this.destroy()}function Se(n,r,i,o){i=i||je.STATUS_CODES[r],o={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(i),...o},n.once("finish",n.destroy),n.end(`HTTP/1.1 ${r} ${je.STATUS_CODES[r]}\r
`+Object.keys(o).map(f=>`${f}: ${o[f]}`).join(`\r
`)+`\r
\r
`+i)}function fe(n,r,i,o,f){if(n.listenerCount("wsClientError")){const l=new Error(f);Error.captureStackTrace(l,fe),n.emit("wsClientError",l,i,r)}else Se(i,o,f)}const dn=be(nn);export{hn as Receiver,cn as Sender,pn as WebSocket,dn as WebSocketServer,an as createWebSocketStream,pn as default};
