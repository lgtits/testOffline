import{_ as pe}from"./CommonModal.4832086d.js";import{Q as ge,_ as he,p as fe,a as be}from"./promptLangOptions.799b0742.js";import{A as ke,i as P,M as ye,aa as $e,d as z,r as l,bg as we,o as a,e as i,g as e,t as g,a$ as X,F as E,aH as F,f as y,q as $,w as R,x as U,u as O,_ as J,aI as K,aJ as Y,k as Z,h as ee,S as te,l as se,m as Ce,Q as Be,y as V,n as D,b3 as Ie,j as Le,a as N,a3 as Ae,be as Ee,p as H,bh as xe,bi as Me}from"./index.125062c9.js";import{F as oe}from"./Format.45ca4c10.js";import{N as j}from"./Notify.d826bef8.js";import{C as A}from"./OnlineChatbotServices.cfd5be1b.js";import{D as Se}from"./Dialog.75687676.js";import{Q as Te}from"./QSelect.72862115.js";import"./ClosePopup.6c0c0609.js";import"./QItemSection.574b5d90.js";import"./QItemLabel.e1e9f191.js";import"./format.65fd2131.js";const Ne=["top","middle","bottom"];var He=ke({name:"QBadge",props:{color:String,textColor:String,floating:Boolean,transparent:Boolean,multiLine:Boolean,outline:Boolean,rounded:Boolean,label:[Number,String],align:{type:String,validator:s=>Ne.includes(s)}},setup(s,{slots:w}){const f=P(()=>s.align!==void 0?{verticalAlign:s.align}:null),v=P(()=>{const c=s.outline===!0&&s.color||s.textColor;return`q-badge flex inline items-center no-wrap q-badge--${s.multiLine===!0?"multi":"single"}-line`+(s.outline===!0?" q-badge--outline":s.color!==void 0?` bg-${s.color}`:"")+(c!==void 0?` text-${c}`:"")+(s.floating===!0?" q-badge--floating":"")+(s.rounded===!0?" q-badge--rounded":"")+(s.transparent===!0?" q-badge--transparent":"")});return()=>ye("div",{class:v.value,style:f.value,role:"status","aria-label":s.label},$e(w.default,s.label!==void 0?[s.label]:[]))}});const ae=s=>(K("data-v-651e4d25"),s=s(),Y(),s),Oe={class:"book-list-info-btn center-img"},De={key:0,class:"book-list-info-btn__book-list"},Fe={class:"list-head flex justify-between"},Re={class:"list-head__title"},Ve=ae(()=>e("img",{src:"/images/icons/close.svg",alt:""},null,-1)),Pe=[Ve],Ue={class:"list-content customized-scrollbar"},qe={class:"document-info column justify-between"},Qe={class:"document-info__title cursor-pointer"},je={class:"document-info__origin"},ze={class:"date"},Ge={class:"document-info__committee"},We=ae(()=>e("img",{src:"/images/icons/info_icon.svg",alt:""},null,-1)),Xe=z({__name:"BookListInfoBtn",props:{documentList:{type:Array,required:!0}},setup(s){const w=s,f=l(!1),v=()=>{f.value=!f.value};return(c,b)=>{const C=we("click-away");return a(),i("div",Oe,[f.value?(a(),i("div",De,[e("div",Fe,[e("div",Re,g(c.$t("$i18n_list_$i18n")),1),e("div",{class:"list-head__close cursor-pointer",onClick:v},Pe)]),X((a(),i("div",Ue,[(a(!0),i(E,null,F(w.documentList,d=>(a(),i("div",{class:"document flex justify-between items-center",key:d.data_key},[e("div",qe,[e("div",Qe,g(d.name),1),e("div",je,[U(" ["+g(c.$t("$i18n_source_$i18n"))+g(d.origin)+"] \u2014 ",1),e("span",ze,g(O(oe).formatDate(d.date)),1)]),e("div",Ge,g(c.$t("$i18n_conferenceName_$i18n"))+"\uFF1A"+g(d.conference),1)])]))),128))])),[[C,v]])])):y("",!0),e("div",{class:"book-list-info-btn__icon cursor-pointer",onClick:v},[We,$(He,{class:"hint",color:"primary",floating:""},{default:R(()=>[U("\u986F\u793A\u6587\u4EF6\u6E05\u55AE")]),_:1})])])}}});var Je=J(Xe,[["__scopeId","data-v-651e4d25"]]);const Ke={class:"bookcase-sidebar column"},Ye=e("div",{class:"toggle-bar-wrapper"},null,-1),Ze={class:"search-area"},et={class:"bookcase-wrapper customized-scrollbar"},tt={class:"date"},st={class:"bookcases column"},ot=["to"],at=["onClick"],nt=z({__name:"BookcaseSidebar",props:{bookcasesList:{type:Array,required:!0}},emits:["resetBookcaseList"],setup(s,{emit:w}){const f=s,v=w,{t:c}=Z({useScope:"global"}),b=l(""),C=ee(),d=P(()=>C.params.bookcaseId),B=l([]),k=l([]),S=()=>{const n=b.value.toLowerCase(),_=B.value.map(u=>{const r=u.bookcases.filter(m=>m.title.toLowerCase().includes(n));return{date:u.date,bookcases:r.length>0?r:null}});k.value=_.filter(u=>u.bookcases!==null)},I=async n=>{Se.confirm({title:`${c("delete")}${c("bookcase")}(${n.title})\uFF1F`,message:`${c("$i18n_deletedNotRecover_$i18n")}`,onOk:async()=>{const _=await A.deleteConversation(n.id);j.error(_.result.success?"\u5DF2\u522A\u9664":_.result.message),v("resetBookcaseList",n.id)}})};te(f.bookcasesList,n=>{console.log("changed",n),x()},{deep:!0});const x=()=>{B.value=[],f.bookcasesList.forEach(n=>{const _=n.updated_at,u={id:n.id,created_at:n.created_at,updated_at:n.updated_at,title:n.title,document_list:n.document_list},r=B.value.find(m=>m.date===_);r?r.bookcases?.push(u):B.value.push({date:_,bookcases:[u]})}),k.value=B.value};return se(()=>{x()}),(n,_)=>{const u=Ce("router-link");return a(),i("div",Ke,[Ye,e("div",Ze,[$(Be,{outlined:"","bg-color":"white",modelValue:b.value,"onUpdate:modelValue":[_[0]||(_[0]=r=>b.value=r),S]},{append:R(()=>[$(V,{name:"sym_o_search",size:"20px",class:"cursor-pointer",onClick:S})]),_:1},8,["modelValue"])]),e("div",et,[(a(!0),i(E,null,F(k.value,r=>(a(),i("div",{class:"bookcase-block",key:r.date},[e("div",tt,g(r.date),1),e("div",st,[(a(!0),i(E,null,F(r.bookcases,m=>(a(),i("div",{to:`/${n.$i18n.locale}/bookcase/${m.id}`,class:D(["bookcase row justify-between items-center",{active:m.id===d.value}]),key:m.id},[$(u,{to:`/${n.$i18n.locale}/bookcase/${m.id}`,class:"name"},{default:R(()=>[U(g(m.title),1)]),_:2},1032,["to"]),e("img",{src:"/images/icons/delete.svg",class:"cursor-pointer",alt:"",onClick:Ie(L=>I(m),["stop"])},null,8,at)],10,ot))),128))])]))),128))])])}}});const lt=s=>(K("data-v-fd57c43a"),s=s(),Y(),s),it={key:0,class:"chatbot-page row"},ct=lt(()=>e("img",{src:"/images/icons/hamburger.svg",alt:""},null,-1)),rt=[ct],ut={class:"chatbot-page__message-area column"},dt={class:"chatbot-header"},_t={class:"chatbot-header__content row justify-between items-center"},vt={class:"chatbot-header__content__info"},mt={class:"title row items-center"},pt={class:"cursor-pointer"},gt={class:"date"},ht={class:"chatbot-header__content__info-icon cursor-pointer"},ft={key:0,class:"message user-message"},bt={key:1,class:"row items-center justify-end"},kt={class:"q-ml-xs text-negative"},yt={key:2,class:"message"},$t={class:"chatbot-footer"},wt={key:0,class:"lang-select row justify-end"},Ct={class:"chatbot-footer__content"},Bt={class:"chatbot-footer__content__input row w-100 full-width justify-between items-center"},It=["placeholder"],Lt=z({__name:"OnlineChatbotPageBookcase",setup(s){const w=Le(),{locale:f}=Z(),v=l(!N.RUNTIME_EXPAND_CHATBOT_BOOKCASE),c=l(),b=l(),C=l(!1),d=l(""),B=ee(),k=P(()=>B.params.bookcaseId.toString()),S=l(),I=l(),x=l(),n=l(),_=l(!1),u=l(!0),r=l(!1),m=l(),L=l([]),M=l({id:"",title:"",created_at:"",updated_at:"",document_list:[]}),q=l(N.BUILD_CHATBOT_TEXTAREA_LANGUAGE),ne=()=>v.value=!v.value,le=async o=>{r.value=!1;const t=await A.patchConversation(k.value,{title:o});if(t.result.success){M.value.title=t.result.title;let p=L.value.find(T=>T.id===k.value);p&&(p.title=t.result.title),j.success("\u4FEE\u6539\u6210\u529F")}else j.error("\u4FEE\u6539\u5931\u6557")},Q=async o=>{if(!!u.value){x.value=o,d.value="",_.value=!0,u.value=!1;try{const t=await A.postMessage(S.value,k.value,{message:o,history:I.value},q.value);console.log("resp: ",t),I.value=t,_.value=!1,n.value=""}catch(t){n.value=t.message||"Error"}finally{u.value=!0}}};te(()=>d.value,o=>{c.value.style.height="25px";const t=N.RUNTIME_CHATBOT_TEXTAREA_HEIGHT;if(o){if(c.value.clientHeight>=t)return;const p=c.value.scrollHeight>=t?t:c.value.scrollHeight;c.value.style.height="25px",c.value.style.height=p+"px"}});const ie=async o=>{const t=await A.getConversations();L.value=t.result.groups;const p=L.value.find(T=>T.id===o);p&&(M.value={...p})},ce=async o=>{const t=await A.getRecommendPrompts(o);m.value=t.result.recommend_prompts},re=async o=>{const t=await A.getHistoryMessages(o);I.value=t.result.history_messages},G=async o=>{console.log("page init: ",o),await ie(o),await re(o),await ce(f.value),C.value=!0},ue=async o=>{if(console.log("deleted: ",o),console.log("bookcaseId: ",k),o===k.value){console.log(L.value);const t=L.value.find(p=>p.id!==o)?.id;t&&console.log("firstBookcaseId: ",t),w.push(`/${f.value}/bookcase/${t}`)}};return se(async()=>{await G(k.value),S.value=await A.initAppClient(),b.value.scrollTop=b.value.scrollHeight}),Ae(()=>{b.value.scrollTop=b.value.scrollHeight}),Ee(async(o,t,p)=>{p(),await G(o.params.bookcaseId.toString())}),(o,t)=>{const p=nt,T=Je,de=be,_e=he,ve=pe;return a(),i(E,null,[C.value?(a(),i("div",it,[e("div",{class:D(["chatbot-page__sidebar",{collapse:v.value}])},[e("div",{class:D(["toggle-sidebar cursor-pointer items-center row",{reverse:v.value}]),onClick:ne},rt,2),v.value?y("",!0):(a(),H(p,{key:0,bookcasesList:L.value,onResetBookcaseList:ue},null,8,["bookcasesList"]))],2),e("div",ut,[e("div",dt,[e("div",_t,[e("div",vt,[e("div",mt,[e("span",null,g(M.value.title),1),e("span",pt,[e("img",{src:"/images/icons/pencil.svg",alt:"",onClick:t[0]||(t[0]=h=>r.value=!r.value)})])]),e("div",gt,g(M.value.updated_at),1)]),e("div",ht,[$(T,{documentList:M.value.document_list},null,8,["documentList"])])])]),e("div",{class:"chatbot-message-wrapper customized-scrollbar column",ref_key:"messageWrapper",ref:b},[(a(!0),i(E,null,F(I.value,h=>(a(),i(E,{key:h},[(a(!0),i(E,null,F(h,(W,me)=>(a(),H(de,{key:W,message:W,role:me===0?"user":"bot",messageId:O(oe).getChatbotResponseId(h[1]),selectedMessage:!1},null,8,["message","role","messageId"]))),128))],64))),128)),_.value?(a(),i("div",ft,[U(g(x.value)+" ",1),n.value?(a(),H(V,{key:0,class:"restart-btn",name:"sym_o_restart_alt",size:"md",onClick:t[1]||(t[1]=h=>Q(x.value))})):y("",!0)])):y("",!0),n.value?(a(),i("div",bt,[$(V,{name:"sym_o_error",color:"negative"}),e("span",kt,g(n.value),1)])):y("",!0),u.value?y("",!0):(a(),i("div",yt,[$(ge,{color:"primary",size:"2em"})]))],512),!I.value.length&&O(N).RUNTIME_SHOW_CHATBOT_RECOMMEND_PROMPT?(a(),H(_e,{key:0,options:m.value,onSubmitOption:Q},null,8,["options"])):y("",!0),e("div",$t,[O(N).RUNTIME_SHOW_CHATBOT_PROMPT_LANGUAGE?(a(),i("div",wt,[$(Te,{dense:"",borderless:"",modelValue:q.value,"onUpdate:modelValue":t[2]||(t[2]=h=>q.value=h),options:O(fe),behavior:"menu","emit-value":""},{prepend:R(()=>[$(Me,null,{default:R(()=>[$(V,{name:"sym_o_language",size:"sm"})]),_:1})]),_:1},8,["modelValue","options"])])):y("",!0),e("div",Ct,[e("div",Bt,[X(e("textarea",{rows:"1",class:"customized-scrollbar",placeholder:o.$t("$i18n_Input_problem_$i18n"),ref_key:"textareaBlock",ref:c,"onUpdate:modelValue":t[3]||(t[3]=h=>d.value=h)},null,8,It),[[xe,d.value]]),e("div",{class:D(["submit-btn",{"cursor-pointer":d.value&&u.value}]),onClick:t[4]||(t[4]=h=>Q(d.value))},[e("img",{src:"/images/icons/submit_btn.svg",alt:"",class:D({empty:!d.value||!u.value})},null,2)],2)])])])])])):y("",!0),C.value?(a(),H(ve,{key:1,title:"\u91CD\u65B0\u547D\u540D",placeholder:"\u8ACB\u8F38\u5165\u66F8\u6AC3\u540D\u7A31",defaultName:M.value.title,modelValue:r.value,"onUpdate:modelValue":t[5]||(t[5]=h=>r.value=h),onSubmitInput:le},null,8,["defaultName","modelValue"])):y("",!0)],64)}}});var Vt=J(Lt,[["__scopeId","data-v-fd57c43a"]]);export{Vt as default};
